ADD_FILES="static/data.js static/main.js static/style.css"
GITHUB_REPO="maruuusa83/profile"

PUSH_URI="https://$GITHUB_SECRET_TOKEN@github.com/$GITHUB_REPO"

if ! grep -q "release-master" <<< "$TRAVIS_BRANCH"; then
  exit 0
fi

REPO_TEMP=$(mktemp -d)
git clone "https://github.com/$GITHUB_REPO" "$REPO_TEMP"
cd "$REPO_TEMP"

printf '\nMerge into master\n'
git checkout "master"
git merge --no-ff "origin/release-master"

printf '\nAdd compressed files\n'
npm install gulp --save
npm install gulp-cli --save-dev
npm install gulp-sass --save-dev
npm install gulp-uglify --save-dev
gulp
git add $ADD_FILES
git commit -m "an auto commit"
git push "$PUSH_URI" "master"
